extends layout

block title
  title Settings | SurgeTk

block content
  - const isAdminAccess = (user.role === 'admin' || (user.permissions && user.permissions.admin === true))
 
  .settings-container
    .tabsHeaderGroup
      h1 Settings

      // Tabs Navigation
      .tabs
        button.tab-link(data-tab='account' data-route='account').active My Profile
        button.tab-link(data-tab='company-info' data-route='company-info') Firm Info
        button.tab-link(data-tab='team' data-route='team') Team Members
        button.tab-link(data-tab='value-adds' data-route='value-adds') Value Adds
        button.tab-link(data-tab='billing' data-route='firm-billing') Billing
        button#endTab.tab-link(data-tab='security' data-route='security') My Security

    // Single Alert Container for All Tabs
    div#alert-container

    // Tab content container
    .tab-content
      // Account Tab Content
      .tab-panel#account.active
        .tabHeader
          //- p(style='color: red') Debug isAdminAccess (server-side): #{isAdminAccess}
          .tabHeaderText
            h2 My Profile Settings
            p.supportingText Edit Your Profile Settings Here.
          .form-actions
            button#account-cancel-button.btn.btn-secondary(type='button', disabled=true) Cancel
            button#account-save-button.btn.btn-primary(type='button', disabled=true) Save Changes

        hr.dividingLine

        // Basic Info Section
        .section
          form#account-form


            div.form-group.mb-3
              label(for='account-first-name') First Name *
              input.form-control#account-first-name(
                type='text',
                placeholder='Enter your first name',
                value=user.firstName
              )

            div.form-group.mb-3
              label(for='account-last-name') Last Name *
              input.form-control#account-last-name(
                type='text',
                placeholder='Enter your last name',
                value=user.lastName
              )

            div.form-group.mb-3
              label(for='email-address') Email Address *
              input.form-control#email-address(type='email', placeholder='Enter email address', value=user.email)
            

            div.form-group.mb-3
              label(for='profile-avatar') Profile Avatar
              .profile-avatar-container
                .profile-avatar-image-container
                  img.uploaded-avatar-preview.hidden(src='')
                  if user.avatar
                    img.profile-avatar-preview(src=user.avatar, alt='User Avatar', class='profile-avatar-preview')
                  else
                    img.profile-avatar-preview(src='', alt='User Avatar', class='profile-avatar-preview')

                // Upload area
                .upload-box
                  span.upload-icon.material-symbols-outlined upload
                  label.custom-upload-button(for='profile-avatar') Upload
                  .upload-box-text
                    span.or-text.clickToUpload Click to upload
                    span.or-text or drag and drop PNG or JPG (Square images work best).

                // Hidden file input
                input#profile-avatar(type='file', hidden=true)

        hr.dividingLine

        .section
          h3 Change Password
          form#password-form
            div.form-group.mb-3
              label(for='old-password') Old Password
              input.form-control#old-password(type='password', placeholder='Enter old password')
            div.form-group.mb-3
              label(for='new-password') New Password
              input.form-control#new-password(type='password', placeholder='Enter new password')
            div.form-group.mb-3
              label(for='confirm-new-password') Confirm New Password
              input.form-control#confirm-new-password(type='password', placeholder='Confirm new password')

            .form-actions.updatePasswordButtons
              button#cancel-password-button.btn.btn-secondary(type='button', disabled=true) Cancel
              button#update-password-button.btn.btn-primary(type='submit', disabled=true) Update Password

      // Company Info Tab Content
      .tab-panel#company-info
        .tabHeader
          .tabHeaderText
            h2 Firm Information
            p.supportingText View And Edit Your Frim Details Here.
          .form-actions
            button#companyinfo-cancel-button.btn.btn-secondary(type='button', disabled=true) Cancel
            button#companyinfo-save-button.btn.btn-primary(type='button', disabled=true) Save Changes

        hr.dividingLine

        // Single Form for Company Info
        .section
          form#company-info-form
            // Section 1: Company Details
            div.form-group.mb-3
              label(for='company-info-name') Firm Name *
              input.form-control#company-info-name(type='text', placeholder='Enter company name', value=user.companyName, disabled=(!isAdminAccess))
            
            div.form-group.mb-3
              label(for='company-id') Firm ID *
              input.form-control#company-id(type='text', placeholder=user.companyId, value=user.companyId, disabled=true)

            

            div.form-group.mb-3
              label(for='company-info-website') Firm Website URL
              input.form-control#company-info-website(type='url', placeholder='Enter website URL', value=user.companyWebsite, disabled=(!isAdminAccess))

            hr.dividingLine

            // Section 2: Company Logo
            div.form-group.mb-3
              label(for='company-logo') Firm Logo
              .company-logo-wrapper
                // Fixed-size container for logo preview
                .logo-preview-container#companyLogoPreviewContainer
                  // If user.companyLogo exists, display it
                  if user.companyLogo
                    img#companyLogoPreview.company-logo-preview(
                      src=user.companyLogo
                      alt='Company Logo'
                      class='company-logo-preview'
                    )
                  else
                    // Otherwise, display a placeholder image
                    img#companyLogoPreview.company-logo-preview.company-logo-preview-placeholder(
                      src='/images/placeholder-logo.png' 
                      alt='No Logo'
                      class='company-logo-preview'
                    )

                // Upload area
                if isAdminAccess
                  .upload-box
                    span.upload-icon.material-symbols-outlined upload
                    label.custom-upload-button(for='company-logo') Upload
                    .upload-box-text
                      span.or-text.clickToUpload Click to upload
                      span.or-text or drag and drop PNG or JPG (Any orientation).

                // Hidden file input
                input#company-logo(type='file', hidden=true, disabled=(!isAdminAccess))

            // branding color
            div.form-group.mb-3
              label(for='company-branding-color') Firm Branding Color
              // Conditionally add a "color-picker-disabled" class if user is not admin
              #color-picker-container(class=(!isAdminAccess ? 'color-picker-disabled' : ''))
                input#company-branding-color.form-control(
                  type='text',
                  name='companyBrandingColor',
                  value=(user.companyBrandingColor || ''),
                  placeholder='#FFFFFF',
                  style='display:none;'
                )


            hr.dividingLine

            // Section 3: Company Address
            div.form-group.mb-3
              label(for='company-address') Address
              input.form-control#company-address(type='text', placeholder='Enter company address', value=user.companyAddress, disabled=(!isAdminAccess))

            //- hr.dividingLine

            // Section 4: Company Phone Number
            div.form-group.mb-3
              label(for='company-phone') Phone Number
              input.form-control#company-phone(type='text', placeholder='Enter phone number', value=user.phoneNumber, disabled=(!isAdminAccess))

      .tab-panel#value-adds
        .tabHeader
          .tabHeaderText
            h2 Value Adds
            p.supportingText Manage Firm-Wide Value Add Configurations.
          .form-actions
            button#valueadds-cancel-button.btn.btn-secondary(type='button', disabled=true) Cancel
            button#valueadds-save-button.btn.btn-primary(type='button', disabled=true) Save Changes

        hr.dividingLine

        // Buckets Value Add Card Container
        .valueAddCard#bucketsCard
          .valueAddCardHeader
            .header-top
              // Left side: Icon + "Buckets" label
              .valueAddCardTitle
                i.material-symbols-outlined.settings-value-add-icon analytics
                .header-text-subText
                  span.cardTitleText Buckets
                  .valueAddCardSubText The Buckets Value Add breaks a household’s investment portfolio into “buckets” (e.g., Cash, Income, Growth), each serving a specific goal, from immediate liquidity to long-term growth. With dynamic calculations of distribution rates, income potential, and rebalancing thresholds, it provides a clear, goal-based framework to visualize assets and discuss short-term needs and long-term sustainability.

              // Right side: Toggle switch (no label)
              .valueAddToggle
                label.switch
                  input#buckets-enabled(type='checkbox', checked=(bucketsEnabled ? true : undefined))
                  span.slider.round

            // Expand/Collapse arrow or button
            button#bucketsExpandBtn.btn.btn-sm.btn-outline-secondary(type='button')
              i.material-symbols-outlined arrow_drop_down
              | Show Settings

          // Expandable content (hidden by default)
          .valueAddCardBody#bucketsSettingsPanel(style='display: none;')
            .mb-3
              label.form-label(for='buckets-title') Buckets Title
              input.form-control#buckets-title(
                type='text',
                placeholder='Buckets Strategy',
                value=bucketsTitle
              )

            .mb-3
              label.form-label(for='buckets-disclaimer') Buckets Disclaimer
              textarea.form-control#buckets-disclaimer(
                rows='4'
              )= bucketsDisclaimer

      .tab-panel#billing
        - // Simple check to see if subscriptionStatus indicates "annual"
        - // Adjust logic as needed if you store it differently.
        - const isAnnual = subscriptionStatus && subscriptionStatus.toLowerCase().includes('annual');

        .tabHeader
          .tabHeaderText
            h2 Billing
            p.supportingText Manage Your Subscription And Payment Details.
          .form-actions
            button#security-cancel-button.btn.btn-secondary(type='button', disabled=true) Cancel
            button#security-save-button.btn.btn-primary(type='button', disabled=true) Save Changes

        hr.dividingLine
        if cancelAtPeriodEnd
          .alert.alert-warning#cancellation-banner(style='display:none;')
            | Your plan is set to cancel at the end of this billing period.
        else
          .alert.alert-warning#cancellation-banner(style='display:none;')


 

        .section#pricing-plans
          .row.pricing-rows
            // FREE CARD
            .col-md-4
              // Highlight if subscriptionTier === 'free'
              .card.pricing-card(class=(subscriptionTier === 'free' ? 'current-plan' : ''))
                .card-header
                  p Free
                  .price-container 
                    p.price-text $0

                .card-body
                  if subscriptionTier === 'free'
                    button.btn.btn-secondary.disabled.current-plan Current Plan
                  else
                    button#downgrade-free-button.btn.btn-outline-primary(data-plan='free' type='button') Downgrade
                  .pricing-card-description
                    p.descriptive-text Basic features
                    ul
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | 1 Advisor
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | 2 Non-Advisors
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | 2 Value Adds
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | Basic Features

            // PRO CARD
            .col-md-4
              // Highlight if subscriptionTier === 'pro'
              .card.pricing-card(class=(subscriptionTier === 'pro' ? 'current-plan' : ''))
                .card-header
                  p Pro
                  .price-container
                    p.price-text $95
                    p /seat per month
                .card-body
                  if subscriptionTier === 'pro'
                    button.btn.btn-secondary.disabled.current-plan Current Plan
                  else
                    button#upgrade-pro-button.btn.btn-outline-primary(data-plan='pro' type='button') Upgrade
                  .pricing-card-description
                    p.descriptive-text Ideal for professionals
                    ul
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | Pay per seat
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | Access to all value adds
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | Run Surge
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | Priority Support
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | Advanced Features

            // ENTERPRISE CARD
            .col-md-4
              // Highlight if subscriptionTier === 'enterprise'
              .card.pricing-card(class=(subscriptionTier === 'enterprise' ? 'current-plan' : ''))
                .card-header
                  p Enterprise
                  .price-container
                    p.enterprise-price-text Contact for pricing
                .card-body
                  if subscriptionTier === 'enterprise'
                    button.btn.btn-secondary.disabled.current-plan Current Plan
                  else
                    button.btn.btn-outline-primary(data-plan='enterprise' type='button') Contact Us
                  .pricing-card-description
                    p.descriptive-text For larger firms with advanced needs
                    ul
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | Special Pricing
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | Custom Features
                      li
                        i.fas.fa-check-circle.me-2.text-success 
                        | White glove support

        hr.dividingLine

        // Current Subscription Info
        .section#current-plan-section
          h4.tabHeaderText Current Plan
          p.plan-item
            | Plan:
            span#current-plan-text Free

          p.plan-item
            | Seats Purchased:
            span#current-seats-purchased 0

          p.plan-item
            | Next Bill Date:
            span#current-next-bill N/A


          .plan-action-buttons
            button#change-plan-button.btn.btn-primary.mainButton(type='button') Upgrade / Change Plan
            

        hr.dividingLine

        // Payment Method Section
        .section#payment-method-section
          h4.tabHeaderText Payment Method
          p
            | Currently on file: 
            span#payment-method-brand No card
          
            span#payment-method-last4 
          button#update-card-button.btn.btn-secondary.mainButton(type='button' data-bs-toggle='modal' data-bs-target='#updateCardModal') Update Billing Info

        hr.dividingLine

      div#unsavedChangesModal.modal.fade(tabindex='-1' aria-labelledby='unsavedChangesModalLabel' aria-hidden='true')
        div.modal-dialog
          div.modal-content
            div.modal-header
              h5.modal-title#unsavedChangesModalLabel Unsaved Changes
              button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')
            div.modal-body
              p You have unsaved changes. If you leave now, those changes will be lost. 
                | Are you sure you want to continue?
            div.modal-footer
              button.btn.btn-secondary(type='button', data-bs-dismiss='modal' id='stay-here-btn') Cancel
              button.btn.btn-primary(type='button', id='discard-changes-btn') Leave Without Saving
      



      div#subscriptionModal.modal.fade(tabindex='-1' aria-hidden='true')
        .modal-dialog.modal-lg.modal-dialog-centered
          .modal-content

            // Modal Header
            .modal-header
              h5.modal-title Upgrade / Change Your Subscription
              button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')

            // STEP INDICATOR (horizontal steps)
            .modal-body.py-0
              .wizard-step-indicator.d-flex.justify-content-between.mb-3
                .wizard-step-indicator-item#indicator-step-1
                  p.wizard-number 1 
                  p.wizard-title Choose Plan
                .wizard-step-indicator-item#indicator-step-2
                  p.wizard-number 2
                  p.wizard-title Payment Information
                .wizard-step-indicator-item#indicator-step-3
                  p.wizard-number 3
                  p.wizard-title Review

            // Steps
            // Step 1: Plan & Seats
            div#wizard-step-1(style='display:none; flex-direction:column;')
              // BILLING INTERVAL TOGGLE
              .d-flex.align-items-center.mb-4.billing-interval-toggle
                span.me-2.fs-6
                .btn-group#billing-interval-toggle(role='group')
                  button#monthly-button.btn.btn-outline-primary.active(type='button', data-interval='monthly') Monthly
                  button#annual-button.btn.btn-outline-primary(type='button', data-interval='annual') Annual

              // PLAN CARDS
              .d-flex.flex-wrap.gap-3
                // FREE CARD
                .card.plan-card.flex-fill#modal-plan-free(data-plan='free')
                  .card-body
                    h5.card-title Free
                    p.card-text.mb-0 $0
                    small.text-muted Includes basic features

                // PRO CARD
                .card.plan-card.flex-fill#modal-plan-pro(data-plan='pro')
                  .card-body
                    h5.card-title Pro
                    p.card-text#modal-pro-price $40 / mo / seat
                    p#modal-pro-savings.text-success.mt-2(style='display:none;')
                      // e.g. "Save $96 per year!"
                    small.text-muted Ideal for growing teams

                // ENTERPRISE CARD (disabled visually)
                .card.plan-card.flex-fill.text-center.disabled#modal-plan-enterprise(
                  data-plan='enterprise'
                  disabled='true'
                  style='pointer-events:none; opacity:0.6;'
                )

              // SHOW SEAT INPUT ONLY IF PRO
              .mt-4#modal-seat-count-group.form-group(style='display:none;')
                .input-text-group
                  label.form-label(for='modal-seat-count') Number of Seats
                  p.label-sub-text Each seat includes 1 advisor and 2 non-advisors
                input#modal-seat-count.form-control(type='number', min='1', value='1', style='max-width:120px;')

            // Step 2: Payment Info
            div#wizard-step-2(style='display:none;')
              // Enhanced text content:
              p#card-on-file-text

              button#edit-payment-method-button.btn.btn-link(type='button')
                i.material-symbols-outlined.me-1 credit_card
                | Edit / Add Payment Method


            // Step 3: Review
            div#wizard-step-3(style='display:none;')
              .border.p-3.rounded
                p.mb-2
                  strong Plan:
                  |  
                  span#review-plan-name.ms-1
                p.mb-2
                  strong Seats:
                  |  
                  span#review-seat-count.ms-1
                p.mb-2
                  strong Interval:
                  |  
                  span#review-billing-interval.ms-1
                p
                  strong Total Cost:
                  |  
                  span#review-cost.ms-1

            // Modal Footer - Wizard Nav
            .modal-footer
              button#wizard-cancel-button.btn.btn-secondary(type='button', data-bs-dismiss='modal', style='display:none;') Cancel
              button#wizard-prev-button.btn.btn-secondary(type='button', style='display:none;') Back
              button#wizard-next-button.btn.btn-primary(type='button') Next
              button#wizard-confirm-button.btn.btn-primary(type='button', style='display:none;')
                i.material-symbols-outlined.me-1 check_circle
                | Update Subscription



      // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      // Update Payment Method Modal
      // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      div#updateCardModal.modal.fade(tabindex='-1' aria-hidden='true')
        .modal-dialog.modal-dialog-centered
          .modal-content
            .modal-header
              h5.modal-title Update Billing Info
              button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')
            .modal-body
              p.card-p-text Please provide your billing details and card information. This will be used for future charges.

              // Bootstrap Accordion
              div.accordion#billingAccordion

                // PANEL 1: Address Info
                div.accordion-item
                  h2.accordion-header
                    button.accordion-button.collapsed(
                      type='button'
                      data-bs-toggle='collapse'
                      data-bs-target='#collapseAddress'
                      aria-expanded='false'
                      aria-controls='collapseAddress'
                    ) 
                      span Address & Billing Info
                      i.material-symbols-outlined.check-icon.completed-check(style='display:none; margin-right:auto;') done

                  div#collapseAddress.accordion-collapse.collapse(aria-labelledby='headingAddress' data-bs-parent='#billingAccordion')
                    div.accordion-body
                      // Name on Card
                      div.form-group.mb-3
                        label(for='card-holder-name') Name on Card
                        input.form-control#card-holder-name(type='text' placeholder='Jane Doe')

                      // Billing Email
                      div.form-group.mb-3
                        label(for='card-billing-email') Billing Email
                        input.form-control#card-billing-email(type='email' placeholder='jane@example.com')

                      // Address Line 1
                      div.form-group.mb-3
                        label(for='card-address-line1') Address Line 1
                        input.form-control#card-address-line1(type='text' placeholder='123 Main St')

                      // City
                      div.form-group.mb-3
                        label(for='card-address-city') City
                        input.form-control#card-address-city(type='text' placeholder='New York')

                      // State / Province
                      div.form-group.mb-3
                        label(for='card-address-state') State / Province
                        input.form-control#card-address-state(type='text' placeholder='NY')

                      // Postal / ZIP
                      div.form-group.mb-3
                        label(for='card-address-postal') Postal / ZIP Code
                        input.form-control#card-address-postal(type='text' placeholder='10001')

                      // Country
                      div.form-group.mb-3
                        label(for='card-address-country') Country
                        select.form-select#card-address-country
                          option(value='US') United States
                          option(value='CA') Canada
                          option(value='GB') United Kingdom
                          option(value='AU') Australia
                          option(value='DE') Germany
                          option(value='FR') France
                          option(value='') -- Other / Not Listed --

                // PANEL 2: Card Info
                div.accordion-item
                  h2.accordion-header
                    button.accordion-button.collapsed(
                      type='button'
                      data-bs-toggle='collapse'
                      data-bs-target='#collapseCard'
                      aria-expanded='false'
                      aria-controls='collapseCard'
                    ) 
                      span Card Details

                  div#collapseCard.accordion-collapse.collapse(aria-labelledby='headingCard' data-bs-parent='#billingAccordion')
                    div.accordion-body
                      // Stripe Element container (card number, expiry, CVC)
                      div#card-element(style='min-height: 100px; border:1px solid #ccc; padding:10px; border-radius:5px;')
                      // Display errors
                      p#card-errors.text-danger.mt-2

            .modal-footer
              button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Cancel
              button#save-card-button.btn.btn-primary(type='button') Save Card





      // Security Tab Content
      .tab-panel#security
        .tabHeader
          .tabHeaderText
            h2 Security Settings
            p.supportingText Manage Your Security Preferences Here.
          .form-actions
            button#security-cancel-button.btn.btn-secondary(type='button', disabled=true) Cancel
            button#security-save-button.btn.btn-primary(type='button', disabled=true) Save Changes

        hr.dividingLine

        // 2FA Section
        .section(data-2fa-enabled=user.is2FAEnabled)
          h3 Two-Factor Authentication (2FA)
          p#twofa-status-text= user.is2FAEnabled ? '2FA is currently enabled on your account.' : '2FA is currently disabled on your account.'

          // Conditionally Render Enable or Disable 2FA Button
          if user.is2FAEnabled
            button#disable2FA-button.btn.btn-danger(type='button') Disable 2FA
          else
            button#enable-2fa-button.btn.btn-primary(type='button') Enable 2FA

          // 2FA Setup Modal

          // 2FA Setup Modal
          div#twofa-modal.modal.fade(tabindex='-1', aria-labelledby='twofaModalLabel', aria-hidden='true')
            div.modal-dialog.modal-dialog-centered
              div.modal-content
                div.modal-header
                  i.lock-icon.material-symbols-outlined lock
                  h5.modal-title#twofaModalLabel Set up two-factor authentication
                  button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')

                div.modal-body
                  p.modal-subtitle#twofaModalSubtitle 2FA is a fantastic way to improve your account security. Use an authenticator app on your mobile device to scan this QR code and enter the verification code below.
                  img#qr-code.img-fluid(src='', alt='QR Code for 2FA') 

                  // Verification Code Input Section
                  div.verification-code
                    input.form-control.code-segment(type='text', maxlength='1', id='code-segment-1')
                    input.form-control.code-segment(type='text', maxlength='1', id='code-segment-2')
                    input.form-control.code-segment(type='text', maxlength='1', id='code-segment-3')
                    span.hyphen - 
                    input.form-control.code-segment(type='text', maxlength='1', id='code-segment-4')
                    input.form-control.code-segment(type='text', maxlength='1', id='code-segment-5')
                    input.form-control.code-segment(type='text', maxlength='1', id='code-segment-6')

                div.modal-footer
                  button#cancel2fa-button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Cancel
                  button#verify2FA-button.btn.btn-primary(type='button') Confirm
      


        hr.dividingLine

      
        .section
          h3 Last 10 Sign-In Activities
          table.signin-logs-table
            thead
              tr
                th Timestamp
                th Location
                th Device
            tbody#signin-logs-body
              //- Rows will be populated by JavaScript
      
      
      .tab-panel#team(data-company-id=user.companyId data-firm-id=user.firmId data-is-admin=isAdminAccess)
        .tabHeader
          .tabHeaderText
            h2 Team Members
            p.supportingText View and manage your firm's team members.
            //- p.userRoleTag #{user.role}




          .form-actions
            if isAdminAccess
              button#add-team-member-button.btn.btn-primary(type='button') Add Team Member

        hr.dividingLine

 
        .section
          .seat-usage-tags
            span.badge.bg-info.me-2.advisor-seat-badge Advisor Seats Remaining: 
              span#advisor-seats-remaining 0
            span.badge.bg-info.non-advisor-seat-badge Non-Advisor Seats Remaining:
              span#nonadvisor-seats-remaining 0
          .team-members-table-container
            table.team-members-table.table.table-striped.table-hover
              thead
                tr
                  th.tableHead1.avatar-head 
                  th.tableHead1.email-head Email
                  th.tableHead1.role-head Role
                  th.tableHead1.permissions-head Permissions
                  th.tableHead1.status-head Status
                  th.actions-head Actions
                    
              tbody#team-members-body
                // Rows will be inserted dynamically via teams.js

  // At bottom of your Pug or near the Add Team Member modal
  div#edit-team-member-modal.modal.fade(tabindex='-1', aria-labelledby='editTeamMemberModalLabel', aria-hidden='true')
    div.modal-dialog.modal-dialog-centered
      div.modal-content
        div.modal-header
          h5.modal-title#editTeamMemberModalLabel Edit Team Member
          button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')
        div.modal-body
          form#edit-team-member-form
            input(type='hidden' id='edit-user-id')
            div.form-group.mb-3
              label(for='edit-role') Role
              select#edit-role.form-select(name='role')
                option(value='admin') Admin
                option(value='advisor') Advisor
                option(value='assistant') Assistant

            div.form-group.mb-3#editAlsoAdvisorContainer(style='display: none;')
              input#editAlsoAdvisorCheckbox(type='checkbox', name='editAlsoAdvisor')
              label(for='editAlsoAdvisorCheckbox') Also an advisor?

            // For Permissions, we can do checkboxes or text-based JSON input:
            div.form-group.mb-3
              label(for='edit-permissions') Permissions *
              select#edit-permissions.form-select(name='role')
                option(value='admin') Admin
                option(value='advisor') Advisor
                option(value='assistant') Assistant
             

        div.modal-footer
          button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Cancel
          button#edit-submit.btn.btn-primary(type='submit' form='edit-team-member-form') Save Changes



  if isAdminAccess
    div#add-team-member-modal.modal.fade(tabindex='-1', aria-labelledby='addTeamMemberModalLabel', aria-hidden='true')
      div.modal-dialog.modal-dialog-centered
        div.modal-content
          div.modal-header
            h5.modal-title#addTeamMemberModalLabel Invite a New Team Member
            button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')
          div.modal-body
            form#add-team-member-form
              div.form-group.mb-3
                label(for='invite-email') Email Address *
                input#invite-email.form-control(type='email', required=true, placeholder='Enter the email address')

              div.form-group.mb-3
                label(for='invite-role') Role *
                select#invite-role.form-select(name='role', required=true)
                  option(value='advisor') Advisor
                  option(value='assistant') Assistant
                  option(value='admin') Admin

              div.form-group.mb-3#also-advisor-container(style='display: none;')
                input#also-advisor-checkbox(type='checkbox', name='alsoAdvisor')
                label(for='also-advisor-checkbox') Also an advisor?

            
              div.form-group.mb-3
                label(for='invite-permissions') Permissions * 
                select#invite-permissions.form-select(name='permissions', required=true)
                  option(value='advisor') Advisor
                  option(value='assistant') Assistant
                  option(value='admin') Admin
  

          div.modal-footer
            button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Cancel
            button#invite-submit.btn.btn-primary(type='submit', form='add-team-member-form') Invite

  // Confirmation Modal for Removing a Team Member
  div#confirmRemoveModal.modal.fade(tabindex='-1' aria-hidden='true')
    div.modal-dialog.modal-dialog-centered
      div.modal-content
        div.modal-header
          h5.modal-title Confirm Removal
          button.btn-close(type='button' data-bs-dismiss='modal' aria-label='Close')
        div.modal-body
          // We'll dynamically insert the email or message via JS
          p#confirmRemoveMessage Are you sure you want to remove this member?
        div.modal-footer
          button.btn.btn-secondary(type='button' data-bs-dismiss='modal') Cancel
          button#confirmRemoveBtn.btn.btn-danger(type='button') Remove


block scripts
  script.
    window.IS_ADMIN_ACCESS = !{isAdminAccess};
  script(src="https://js.stripe.com/v3")
  script.
    window.STRIPE_PUBLIC_KEY = "#{process.env.STRIPE_PUBLIC_KEY}"; 
    window.PRO_COST_PER_SEAT = "#{process.env.PRO_COST_PER_SEAT}";
   


  script(src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js', integrity='sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz', crossorigin='anonymous')
  script(src='/js/appScript.js')
  script(src='/js/settings.js')
  script(src='/js/teams.js')
  script(src='/js/headerDropdownFilter.js')
  script(src="/js/loading.js")
  script(src='/js/billing.js')
  script(src='https://unpkg.com/@simonwep/pickr/dist/pickr.min.js')
