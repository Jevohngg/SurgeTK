doctype html
html
  head
    script.
      // Apply collapsed class and inline styles immediately
      (function() {
        if (localStorage.getItem('sidebarCollapsed') === 'true') {
          document.documentElement.classList.add('sidebar-collapsed', 'no-transition'); // Apply collapsed and no-transition
          
          // Add inline styles for immediate stabilization
          const style = document.createElement('style');
          style.setAttribute('data-sidebar-init', 'true'); // Mark for cleanup
          style.innerHTML = `
            .sidebar { width: 80px; }
            .sidebar-header { padding: 0 8px; }
            .sidebar .company-logo img { width: 24px; opacity: 0; }
            .content .header { margin-left: 80px; }
            .content .main-content { margin-left: 80px; }
          `;
          document.head.appendChild(style);
        }
      })();

    script.
      // Cleanup after load
      window.addEventListener('load', function() {
        // Remove no-transition class and temporary styles
        document.documentElement.classList.remove('no-transition');
        const styleTag = document.querySelector('style[data-sidebar-init]');
        if (styleTag) {
          styleTag.remove(); // Clean up inline styles
        }
      });



    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')

    // Title block for page-specific titles
    block title
      title SurgeTk

    link(rel='icon' type='image/x-icon' href='/images/collapsedIcon.svg')

    // External Stylesheets
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css')
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/regular.min.css') 
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/light.min.css')  
    link(
      rel="stylesheet"
      href="https://unpkg.com/@simonwep/pickr/dist/themes/classic.min.css"
    )
    
 
  
    link(rel='stylesheet', href='https://fonts.googleapis.com/icon?family=Material+Icons')
  
   




    // Bootstrap CSS 5.3.0 with Correct Integrity
    link(
      rel='stylesheet',
      href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css',
      integrity='sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM',
      crossorigin='anonymous'
    )
    
    link(rel='stylesheet', href='/css/appStyles.css')
    link(rel='stylesheet', href='https://cdn.jsdelivr.net/npm/@fontsource/inter/300.css')
    link(rel='stylesheet', href='https://cdn.jsdelivr.net/npm/@fontsource/inter/400.css')
    link(rel='stylesheet', href='https://cdn.jsdelivr.net/npm/@fontsource/inter/500.css')
    link(rel='stylesheet', href='https://cdn.jsdelivr.net/npm/@fontsource/inter/700.css')

    link(rel='stylesheet', href='https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined')

  body
    #global-loading-overlay
      .spinner-container
        .spinner




    
   

    
    .main-container

      .sidebar
        .sidebar-header
          span.company-logo
            img(src='/images/InvictusLogo.svg', alt='Company Logo', class='sidebar-logo')

        ul.sidebar-nav
          li.nav-item
            a(href='/dashboard')
              .material-symbols-outlined dashboard
              span Welcome
          li.nav-item
            a(href='/households')
              i.fas.fa-users
              span Households
          li.nav-item
            a(href='/import')
              .material-symbols-outlined upload
              span Imports
          li.nav-item
            a(href='/surge')
              i.fas.fa-bolt
              span Surge

      // Content container
      .content
        // Header
        .header
          .header-left
            i.material-icons.sidebar-toggle-icon menu

          .header-center
            if companyData && companyData.companyLogo
              a.company-logo-link(
                href="/settings#company-info"
              )
                img(src=companyData.companyLogo alt="Company Logo" class="uploaded-company-logo")
            else
              a.company-logo-placeholder(
                href="/settings#company-info"

              )
                span.your-logo-text Your logo here

          .header-right
            .connect-redtail-button
              .redtail-logo-container
                img(src='/images/redtail-logo.png', alt='Redtail-Logo', class='redtail-logo')
              p.redtail-button-text Connect Redtail
            .notification-icon-container
              i.fas.fa-bell.action-icon(data-bs-toggle='tooltip', data-bs-placement='bottom', title='Notifications')
              span.notification-badge 

              .notification-dropdown
                .dropdown-menu.notifications-menu
                  // Placeholder for notifications
                  if notifications && notifications.length > 0
                    each notification in notifications
                      .notification-item(data-id=notification._id)
                        if !notification.isRead
                          .unread-indicator
                        .notification-content
                          .notification-title #{notification.title}
                          .notification-message #{notification.message}
                          .notification-timestamp #{notification.timestamp}
                  else
                    p#no-notifications-message(style="display: flex; justify-content: center; align-items: center; align-content: center; padding: 16px; font-size: 14px; color: grey;") No notifications


            i.material-icons(action-icon data-bs-toggle='tooltip', data-bs-placement='bottom', title='Help') help_outline
            i#settings-icon.material-icons(action-icon data-bs-toggle='tooltip', title='Settings') settings

            .dropdown
              .user-avatar
                if avatar
                  img(src=avatar, alt='User Avatar')
                else
                  img(src='/images/defaultProfilePhoto.png', alt='Default Avatar')

              .dropdown-menu.dropdown-menu-end.show-avatar
                .dropdownTop
                  .user-avatar
                    if avatar
                      img(src=avatar, alt='User Avatar')
                    else
                      img(src='/images/defaultProfilePhoto.png', alt='Default Avatar')      

                  .profileText
                    .dropdown-item-text.companyNameText #{user.name}
                    .dropdown-item-text.companyEmailText #{user.email}

                hr.dropdown-divider

                a.dropdown-item(href='/settings')
                  i.fas.fa-cog(style='margin-right: 8px;') 
                  | Account Settings

                form(action="/logout", method="POST")
                  button.dropdown-item(type="submit")
                    i.fas.fa-sign-out-alt(style='margin-right: 8px;') 
                    | Log Out

        .stats-banner-container(style=`background-color: ${companyData && companyData.companyBrandingColor ? companyData.companyBrandingColor : '#282e38'};`)
          .dropdown.d-inline-block
            button#advisorFilterBtn.btn.btn-secondary(type='button', aria-expanded='false')
              p Filter Advisors
              .material-symbols-outlined unfold_more

            ul#advisorFilterDropdown.dropdown-menu.dropdown-menu-end
              li
                // Dynamically populated via JS with checkboxes

          .stats-row.d-flex.justify-content-around.align-items-center
            .stats-group
              // "Total Households" Column
              .stats-item.stats-secondary
                span.stats-icon
                  i.fas.fa-users
                span#total-households-number.text-white 0
                span.stats-label.text-white Households

              // "Total Account Value" Column
              .stats-item.stats-account-value
                span.stats-icon
                  i.fas.fa-landmark
                span#total-value-amount.text-white $0
                

              // "Total Accounts" Column
              .stats-item.stats-secondary
                span.stats-icon
                  i.fas.fa-folder-open
                span#total-accounts-number.text-white 0
                span.stats-label.text-white Accounts


        // Main content area
        .main-content
          div#alert-container
          block content // This block holds the dynamic content

    // Bootstrap JS Bundle 5.3.0 with Correct Integrity
    script(
      src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js',
      integrity='sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz',
      crossorigin='anonymous'
    )

    // JavaScript block for page-specific scripts
    block scripts
      script(src='/js/appScript.js')
      script(src='/js/headerDropdownFilter.js')
      script(src="/socket.io/socket.io.js")
      script(src="/js/loading.js")
      script(src="https://unpkg.com/@simonwep/pickr/dist/pickr.min.js")

    // Initialize Bootstrap tooltips
    script.
      document.addEventListener('DOMContentLoaded', function () {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl)
        })
      })
