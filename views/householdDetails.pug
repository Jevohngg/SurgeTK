extends layout

block title
  title Household Details | SurgeTk

block content

  style.
    .dataBox.marginal-tax {
      position: relative;
      cursor: pointer;
    }
    .dataBox.marginal-tax .edit-icon {
      position: absolute;
      top: 12px;
      right: 0px;
      display: none;
      font-size: 0.9rem;
      color: #6c757d;
    }
    .dataBox.marginal-tax:hover .edit-icon {
      display: block;
    }




  -
    // Compute the household name logic based on modalClients
    var householdName = '---';
    if (modalClients && modalClients.length > 0) {
      var hoh = modalClients[0];
      var hohLast = hoh.lastName || '';
      var hohFirst = hoh.firstName || '';

      if (modalClients.length === 1) {
        householdName = `${hohLast}, ${hohFirst}`;
      } else if (modalClients.length === 2) {
        var second = modalClients[1];
        var secondLast = second.lastName || '';
        var secondFirst = second.firstName || '';

        if (hohLast.toLowerCase() === secondLast.toLowerCase()) {
          householdName = `${hohLast}, ${hohFirst} & ${secondFirst}`;
        } else {
          householdName = `${hohLast}, ${hohFirst} & ${secondLast}, ${secondFirst}`;
        }
      } else {
        householdName = `${hohLast}, ${hohFirst}`;
      }
    }

  input(type="hidden", id="household-id", value=householdId)

  #alert-container


  .household-detail-container
    .topContainer
      .d-flex.align-items-center.mb-3.hhHeader
        a(href='/households', class='me-2 text-decoration-none text-secondary backArrow')
          i.fas.fa-angle-left
        h2.householdDetailHeader #{householdName}

      .tabs
        button#leftEndTab.tab-link(data-tab='client-info',data-route='client-info', class= activeTab === 'client-info' ? 'active' : '') Household Info
        button.tab-link(data-tab='accounts', data-route='accounts', class= activeTab === 'accounts' ? 'active' : '') Financial Assets
        button.tab-link(data-tab='assets', data-route='assets', class= activeTab === 'assets' ? 'active' : '') Physical Assets
        button.tab-link(data-tab='liabilities', data-route='liabilities', class= activeTab === 'liabilities' ? 'active' : '') Liabilities
        button#endTab.tab-link(data-tab='value-adds', data-route='value-adds', class= activeTab === 'value-adds' ? 'active' : '') Value Adds

    
    .tab-content
      .tab-panel#client-info(class= activeTab === 'client-info' ? 'active' : '')
        .row.mb-4.summary-box
            .col-md-3.border-right
              .dataBox
                h6.summary-header.text-muted.mb-1 Total Household Value
                p.fs-4.summary-sub-header $#{totalAccountValue.toLocaleString()}
            .col-md-3.border-right
              .dataBox
                h6.summary-header.text-muted.mb-1 Monthly Distribution
                p.fs-4.summary-sub-header $#{monthlyDistribution.toFixed(2).toLocaleString()}
            .col-md-3.border-right
              .dataBox.marginal-tax
                i.fas.fa-pencil-alt.edit-icon
                h6.summary-header.text-muted.mb-1 Marginal Tax Bracket
                p.fs-4.summary-sub-header
                  if marginalTaxBracket == null
                    | --
                  else
                    | #{marginalTaxBracket.toFixed(0)}%

            .col-md-3
              .dataBox
                h6.summary-header.text-muted.mb-1 Annual Billing
                p.fs-4.text-success
                  if annualBilling === null
                    | --
                  else
                    | $#{annualBilling.toLocaleString()}
        .household-members-container
          each client in clients
            .household-member-card(data-client-id=client._id)
              if client.deceasedLiving === 'Deceased'
                span.deceased-chip Deceased
              // Left: Profile Image
              .card-left
                img.member-profile-avatar(
                  src= client.profilePhoto ? client.profilePhoto : '/images/defaultProfilePhoto.png',
                  alt='Profile Photo'
                )
              // Right: Main info
              .card-right
                // Name row
                h3.member-name #{client.firstName} #{client.lastName}
                .member-dob-and-age
                  // Display DOB in "Mar 10 1999" format (no comma)
                  p.contactSubDOB= client.dob ? new Date(client.dob).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric',timeZone:'UTC'}) : 'No DOB'

                  
                  p |
                  // Age: we use a <span> with an ID so our JS can populate it
                  span.member-age#clientAge(data-dob=client.dob) ( - )
                .account-email-phone
                  .email-and-phone
                    p.member-email= client.email || 'No Email'
                    p.member-phone= client.mobileNumber || client.homePhone || 'No Phone Number'
                  .card-accounts
                    span.accounts-label ASSETS
                    if client.totalAccountValue
                      p.total-account-value $#{client.totalAccountValue.toLocaleString()}
                    else
                      p.total-account-value $0
        // BEGIN: New Advisor Container
        .household-advisors-container.d-flex.align-items-center.mb-3#editHouseholdButton
          h6.summary-header.text-muted.mb-1 Advisor
          .advisor-container-flexed
            if household.leadAdvisors && household.leadAdvisors.length > 0
              each adv in household.leadAdvisors
                .advisor-item.me-3.d-flex.align-items-center
                  img.advisor-avatar(src= adv.avatar ? adv.avatar : '/images/defaultProfilePhoto.png', alt='Advisor Avatar')
                  span.ms-2.advisors-name-2 #{adv.name}
            else
              p.assign-advisor-text No Advisor Assigned (Click to assign)


      .tab-panel#assets(class= activeTab === 'assets' ? 'active' : '')
        .row.mb-4.summary-box
            .col-md-3.border-right
              .dataBox
                h6.summary-header.text-muted.mb-1 Total Household Value
                p.fs-4.summary-sub-header $#{totalAccountValue.toLocaleString()}
            .col-md-3.border-right
              .dataBox
                h6.summary-header.text-muted.mb-1 Monthly Distribution
                p.fs-4.summary-sub-header $#{monthlyDistribution.toFixed(2).toLocaleString()}
            .col-md-3.border-right
              .dataBox.marginal-tax
                i.fas.fa-pencil-alt.edit-icon
                h6.summary-header.text-muted.mb-1 Marginal Tax Bracket
                p.fs-4.summary-sub-header
                  if marginalTaxBracket == null
                    | --
                  else
                    | #{marginalTaxBracket.toFixed(0)}%           

            .col-md-3
              .dataBox
                h6.summary-header.text-muted.mb-1 Annual Billing
                p.fs-4.text-success
                  if annualBilling === null
                    | --
                  else
                    | $#{annualBilling.toLocaleString()}
        .households-controls.d-flex.justify-content-between.mb-3
          .search-bar-container.position-relative
            input#search-assets.form-control(type='text', placeholder='Search assets')
            i.search-icon.fas.fa-search
          button.mainButton.btn.btn-primary#add-asset-button
            i.fas.fa-plus.me-2
            | Add Asset

        .selection-container-assets.assets.bg-light.p-3.mb-3(aria-hidden="true")
          span#assets-selection-count.text-muted No assets selected.
          .selection-actions
            a#clear-assets-selection.text-danger.me-3(href='javascript:void(0)') Clear selection
            button#delete-selected-assets.btn.btn-danger.btn-sm(type='button') Delete


        .table-container.assets
          table.table.table-striped.table-hover
            thead
              tr.imports-tr-header
                th
                  input#select-all-assets(type='checkbox')
                th.thContentContainer.owner-cell 
                  p Owner
                  i.sort-icon.material-icons.ml-2(role='button', data-field='accountOwnerName') arrow_upward
                th.thContentContainer.type-cell 
                  p Type
                  i.sort-icon.material-icons.ml-2(role='button', data-field='assetType') arrow_upward

                th.thContentContainer.value-cell
                  p Value
                  i.sort-icon.material-icons.ml-2(
                    role='button',
                    data-field='assetValue'
                  ) arrow_upward
                
            tbody#assets-table-body
          .pagination-container#assets-pagination.d-flex.justify-content-between.align-items-center.mt-3
            nav
              ul.pagination.mb-0
            span#assets-pagination-info.pagination-info.text-muted

        //- .empty-state.assets.hidden.mt-4.text-center
        //-   h5.text-muted No assets found
        //-   p.text-muted Click “Add Asset” to get started
        .empty-state.assets.hidden.mt-4
          .empty-state-text
              h2 No assets found
              p.text-muted Get started by adding an asset or upload asset data on the import page.
              .empty-buttons
                  button#empty-add-asset-button.btn.btn-primary(type='button')
                          i.fas.fa-plus.me-2
                          | Add Asset
          .images-conainer-no-hh 
              img.background-image-empty-state(src='/images/circle-background.png')
              img.empty-state-icon(src='/images/noAccount.png')

      .tab-panel#liabilities(class= activeTab === 'liabilities' ? 'active' : '')
        .households-controls.d-flex.justify-content-between.mb-3
          .search-bar-container.position-relative
            input#search-liabilities.form-control(type='text', placeholder='Search liabilities...')
            i.search-icon.fas.fa-search
          button.mainButton.btn.btn-primary#add-liability-button
            i.fas.fa-plus.me-2
            | Add Liability


        .selection-container-liabilities.liabilities.bg-light.p-3.mb-3(aria-hidden="true")
          span#liabilities-selection-count.text-muted No liabilities selected.
          .selection-actions
            a#clear-liabilities-selection.text-danger.me-3(href='javascript:void(0)') Clear selection
            button#delete-selected-liabilities.btn.btn-danger.btn-sm(type='button') Delete

        .table-container.liabilities
          table.table.table-striped.table-hover
            thead
              tr.imports-tr-header
                // checkbox column
                th
                  input#select-all-liabilities.select-all-liabilities.liability-checkbox(type='checkbox', aria-label='Select All Liabilities')
                // owner column
                th.owner-cell
                  .thContentContainer
                    p Owner
                    i.sort-icon.material-icons.ml-2(role='button', data-field='owner.firstName') arrow_upward
                // type column
                th.type-cell
                  .thContentContainer
                    p Type
                    i.sort-icon.material-icons.ml-2(role='button', data-field='liabilityType') arrow_upward
                // balance column
                th.balance-cell
                  .thContentContainer
                    p Balance
                    i.sort-icon.material-icons.ml-2(role='button', data-field='outstandingBalance') arrow_upward
                // actions column

            tbody#liabilities-table-body
          .pagination-container#liabilities-pagination.d-flex.justify-content-between.align-items-center.mt-3
            nav
              ul.pagination.mb-0
            span#liabilities-pagination-info.text-muted.pagination-info


     
        .empty-state.liabilities.hidden.mt-4
          .empty-state-text
              h2 No liabilities found
              p.text-muted Get started by adding a liability or upload liability data on the import page.
              .empty-buttons
                  button#empty-add-liability-button.btn.btn-primary.mainButon(type='button')
                          i.fas.fa-plus.me-2
                          | Add Liability
          .images-conainer-no-hh 
              img.background-image-empty-state(src='/images/circle-background.png')
              img.empty-state-icon(src='/images/noAccount.png')

      .tab-panel#value-ads(class= activeTab === 'value-adds' ? 'active' : '')
        .value-adds-container
   


          if household.firmId && household.firmId.guardrailsEnabled
            #openGuardrails.value-adds-card.guardrails-container.mt-3
              .material-symbols-outlined.value-add-icon add_road
              h5.summary-header.mb-2.value-add-title Guardrails
              .status-icon.material-symbols-outlined check_circle
          else
            #openGuardrails.value-adds-card.guardrails-container.mt-3.inactive(
              data-bs-toggle='tooltip',
              data-bs-placement='top',
              title='Guardrails Value Add is turned off in the Settings.'
            )
              .material-symbols-outlined.value-add-icon add_road
              h5.summary-header.mb-2.value-add-title Guardrails
              .status-icon.warning.material-symbols-outlined warning

          // Buckets card
          if household.firmId && household.firmId.bucketsEnabled
            // Enabled Buckets
            #openBuckets.value-adds-card.guardrails-container.mt-3
              .material-symbols-outlined.value-add-icon analytics
              h5.summary-header.mb-2.value-add-title Buckets
              .status-icon.material-symbols-outlined check_circle
          else
            // Disabled Buckets
            #openBuckets.value-adds-card.guardrails-container.mt-3.inactive(
              data-bs-toggle='tooltip',
              data-bs-placement='top',
              title='Buckets Value Add is turned off in the Settings.'
            )
              .material-symbols-outlined.value-add-icon analytics
              h5.summary-header.mb-2.value-add-title Buckets
              .status-icon.warning.material-symbols-outlined warning


          if household.firmId && beneficiaryEnabled
            // => The firm has "Beneficiary" turned ON
            if beneficiaryHasWarnings
              // => If the Beneficiary ValueAdd has warnings, show the warning icon
              #openBeneficiary.value-adds-card.guardrails-container.mt-3
                .material-symbols-outlined.value-add-icon diversity_1
                h5.summary-header.mb-2.value-add-title Beneficiary
                .status-icon.warning.material-symbols-outlined warning
            else
              // => Otherwise, success icon
              #openBeneficiary.value-adds-card.guardrails-container.mt-3
                .material-symbols-outlined.value-add-icon diversity_1
                h5.summary-header.mb-2.value-add-title Beneficiary
                .status-icon.material-symbols-outlined check_circle
          else
            // => The firm turned OFF Beneficiary => entire card is inactive
            #openBeneficiary.value-adds-card.guardrails-container.mt-3.inactive(
              data-bs-toggle='tooltip'
              data-bs-placement='top'
              title='Beneficiary Value Add is turned off in Settings.'
            )
              .material-symbols-outlined.value-add-icon diversity_1
              h5.summary-header.mb-2.value-add-title Beneficiary
              .status-icon.warning.material-symbols-outlined warning


      
          if household.firmId && household.firmId.netWorthEnabled
            #openNetWorth.value-adds-card.guardrails-container.mt-3
              .material-symbols-outlined.value-add-icon account_balance
              h5.summary-header.mb-2.value-add-title Net Worth
              .status-icon.material-symbols-outlined check_circle
          else
            #openNetWorth.value-adds-card.guardrails-container.mt-3.inactive(
              title='Net Worth Value Add is turned off in the Settings.'
            )
              .material-symbols-outlined.value-add-icon account_balance
              h5.summary-header.mb-2.value-add-title Net Worth
              .status-icon.warning.material-symbols-outlined warning



          //- #open1099Letter.value-adds-card.guardrails-container.mt-3
          //-   .material-symbols-outlined.value-add-icon receipt_long
          //-   h5.summary-header.mb-2.value-add-title 1099 Letter
          //-   .status-icon.material-symbols-outlined check_circle
          //- #openbeneficiary.value-adds-card.guardrails-container.mt-3
          //-   .material-symbols-outlined.value-add-icon diversity_1
          //-   h5.summary-header.mb-2.value-add-title Beneficiary
          //-   .status-icon.material-symbols-outlined check_circle
          //- #openEstateDoc.value-adds-card.guardrails-container.mt-3
          //-   .material-symbols-outlined.value-add-icon balance
          //-   h5.summary-header.mb-2.value-add-title Estate Doc
          //-   .status-icon.material-symbols-outlined check_circle
          //- #openHomework.value-adds-card.guardrails-container.mt-3
          //-   .material-symbols-outlined.value-add-icon inventory
          //-   h5.summary-header.mb-2.value-add-title Homework
          //-   .status-icon.material-symbols-outlined check_circle


        // ── NEW:  Saved Value Adds table ─────────────────────────────
        // ───────── NEW: Saved Value Add Snapshots ─────────
        .table-and-pagination-container
          .saved-value-adds-table.mt-4
            // Wrap the table so we can hide it when empty
            .table-container
              table.table.table-hover#savedValueAddsTable
                thead
                  tr.header-tr-saved-value-adds
                    th(width='36')
                    th.thContentContainer.value-add-th
                      p Value Add
                    th.thContentContainer.notes-th
                      p Notes
                    th.thContentContainer.date-created-th
                      p Date Created
                    th(width='36') 
                tbody#savedValueAddsTbody
            .pagination-container#savedValueAdds-pagination.d-flex.justify-content-between.align-items-center.mt-3
              nav
                ul.pagination.mb-0
              span#savedValueAdds-pagination-info.text-muted.pagination-info
                  // rows will be injected by JS
  
          // Empty state, hidden by default
          .empty-state.value-adds.hidden.mt-4
            .empty-state-text
              h2 No Value Adds Created
              p.text-muted You haven’t created any Value Adds for this household yet.
            .images-conainer-no-hh
              img.background-image-empty-state(src='/images/circle-background.png')
              img.empty-state-icon(src='/images/noAccount.png')



      .tab-panel#accounts(class= activeTab === 'accounts' ? 'active' : '')
        .row.mb-4.summary-box
            .col-md-3.border-right
              .dataBox
                h6.summary-header.text-muted.mb-1 Total Household Value
                p.fs-4.summary-sub-header $#{totalAccountValue.toLocaleString()}
            .col-md-3.border-right
              .dataBox
                h6.summary-header.text-muted.mb-1 Monthly Distribution
                p.fs-4.summary-sub-header $#{monthlyDistribution.toFixed(2).toLocaleString()}
            .col-md-3.border-right
              .dataBox.marginal-tax
                i.fas.fa-pencil-alt.edit-icon
                h6.summary-header.text-muted.mb-1 Marginal Tax Bracket
                p.fs-4.summary-sub-header
                  if marginalTaxBracket == null
                    | --
                  else
                    | #{marginalTaxBracket.toFixed(0)}%       
            .col-md-3
              .dataBox
                h6.summary-header.text-muted.mb-1 Annual Billing
                p.fs-4.text-success
                  if annualBilling === null
                    | --
                  else
                    | $#{annualBilling.toLocaleString()}


        .households-controls.d-flex.justify-content-between.mb-3
            .search-bar-container.position-relative
                input#search-accounts.form-control.me-2(type='text', placeholder='Search accounts')
                i.search-icon.fas.fa-search
            button.btn.btn-primary.mb-3.mainButton#add-account-button 
              i.fas.fa-plus.me-2
              p Add Account
             
        // Selection Container (Hidden by default, appears when accounts selected)
        .selection-container.bg-light.p-3.mb-3.d-flex.justify-content-between.align-items-center(aria-hidden="true")
          .selectionText
            span#selection-count.text-muted
                |No records selected.
          .selection-actions
            a#clear-selection.text-danger.me-3(href='javascript:void(0)') Clear selection
            button#delete-selected.btn.btn-danger.btn-sm(type='button') Delete
        .table-and-pagination-container
         
          
          table#accounts-table.table.table-striped.table-hover
            thead
              tr.imports-tr-header
                th.inputTh
                  input#select-all(type='checkbox', aria-label='Select All Accounts')
                th.owner-cell
                  .thContentContainer
                    p Owner
                    i.sort-icon.material-icons.ml-2(role='button', data-field='accountOwnerName') arrow_upward
                th.account-number-cell
                  .thContentContainer
                    p Account #
                   
                th.type-cell
                  .thContentContainer
                    p Type
                    i.sort-icon.material-icons.ml-2(role='button', data-field='accountType') arrow_upward
                th.monthly-dist-cell
                  .thContentContainer
                    p Distribution
                    i.sort-icon.material-icons.ml-2(role='button', data-field='systematicWithdrawAmount') arrow_upward
                th.updated-cell
                  .thContentContainer
                    p As Of
                    i.sort-icon.material-icons.ml-2(role='button', data-field='asOfDate') arrow_upward
                th.total-cell
                  .thContentContainer
                    p Value
                    i.sort-icon.material-icons.ml-2(role='button', data-field='accountValue') arrow_upward
            tbody#accounts-table-body
              // JS will populate account rows with checkboxes and data
          .pagination-container.d-flex.justify-content-between.align-items-center.mt-3
            nav
              ul.pagination.mb-0
                li.page-item
                  button#prev-page.page-link(type='button') Previous
                li.page-item
                  button#next-page.page-link(type='button') Next
            span#pagination-info.text-muted
          // Message for no accounts
          p#no-accounts-message(style='display: none;') No accounts available.
        .empty-state-container.hidden.mt-4
          .empty-state-text
              h2 No accounts found
              p.text-muted Get started by adding an account or upload acccount data on the import page.
              .empty-buttons
                  button#empty-add-account-button.btn.btn-primary(type='button', onclick="openAddHouseholdModal()")
                          i.fas.fa-plus.me-2
                          | Add account
          .images-conainer-no-hh 
              img.background-image-empty-state(src='/images/circle-background.png')
              img.empty-state-icon(src='/images/noAccount.png')

  //–– Edit Marginal Tax Bracket Modal
  div#editMarginalModal.modal.fade(tabindex='-1', aria-hidden='true')
    div.modal-dialog.modal-md
      div.modal-content
        div.modal-header
          h5.modal-title Marginal Tax Bracket
          button.btn-close(type='button', data-bs-dismiss='modal')
        div.modal-body
          form#modalMarginalForm
            .mb-3
              label.form-label(for='modalMarginalTaxBracket') Marginal Tax Bracket (%)
              input.form-control#modalMarginalTaxBracket(
                type='number', step='0.01', min='0', max='100', required
              )
        div.modal-footer
          button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Cancel
          button.btn.btn-primary(type='submit', form='modalMarginalForm') Save


  div#viewAccountModal.modal.fade(tabindex='-1', aria-labelledby='viewAccountModalLabel', aria-hidden='true')
    div.modal-dialog.modal-lg
      div.modal-content
        div.modal-header
          h5.modal-title#viewAccountModalLabel Account Details
          button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')
        div.modal-body
          div#view-account-content
            // Content will be populated dynamically
        div.modal-footer
          button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Close


  div#deleteConfirmationModal.modal.fade(tabindex='-1', aria-labelledby='deleteConfirmationModalLabel', aria-hidden='true')
      div.modal-dialog
        div.modal-content
          div.modal-header
            h5.modal-title#deleteConfirmationModalLabel Confirm Deletion
            button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')
          div.modal-body
            p#delete-modal-message Are you sure you want to delete the selected accounts? This action cannot be undone and will remove all associated account data.
          div.modal-footer
            button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Cancel
            button.btn.btn-primary(type='button', id='confirm-delete') Delete

  // Confirmation Modal
  div#confirmDeleteModal.modal.fade(tabindex='-1' aria-labelledby='confirmDeleteModalLabel' aria-hidden='true')
    div.modal-dialog.modal-dialog-centered
      div.modal-content
        div.modal-header
          h5.modal-title#confirmDeleteModalLabel Delete Client
          button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')
        div.modal-body
          p Are you sure you want to delete this client?
          p This action cannot be undone.
        div.modal-footer
          button.btn.btn-secondary#cancelDeleteBtn(type='button', data-bs-dismiss='modal') Cancel
          button.btn-primary.btn.btn-danger#confirmDeleteBtn(type='button') Yes, Delete

  // Snapshot‑Delete Confirmation
  div#deleteSnapshotModal.modal.fade(tabindex='-1', aria-hidden='true')
    div.modal-dialog
      div.modal-content
        div.modal-header
          h5.modal-title Delete Snapshot
          button.btn-close(type='button', data-bs-dismiss='modal')
        div.modal-body
          p.mb-0 Are you sure you want to delete this snapshot?
          p This action cannot be undone.
        div.modal-footer
          button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Cancel
          button#confirmDeleteSnapshot.btn.btn-primary(type='button') Delete
  

  div#editHouseholdModal.modal.fade(tabindex='-1', aria-labelledby='editHouseholdModalLabel', aria-hidden='true')
    div.modal-dialog.modal-lg.modal-dialog-scrollable
      div.modal-content
        div.modal-header
          h5.modal-title#editHouseholdModalLabel Edit Household
          button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')

        div.modal-body
          form#edit-household-form
            h6.mb-3.formModalHeadersOne Head of Household Information

            // Advisor Selection (Mirroring Add Household Modal)
            .mb-3
              label.form-label(for='editdLeadAvisors') Assign Advisors
              .dropdown#editAdvisorDropdownContainer
                button#editAdvisorDropdownButton.btn.btn-outline-secondary.dropdown-toggle(type='button', data-bs-toggle='dropdown', aria-expanded='false')
                  p.notNeeded Select advisors...
                ul#editAdvisorDropdownMenu.dropdown-menu
                // We'll populate this list dynamically with JavaScript
              input#editSelectedAdvisorsInput(type='hidden', name='leadAdvisors')

            .mb-3
              label.form-label(for='editFirstName2') First Name *
              input.form-control(type='text', id='editFirstName2', name='firstName', required=true, placeholder='Enter first name')

            .mb-3
              label.form-label(for='editLastName2') Last Name *
              input.form-control(type='text', id='editLastName2', name='lastName', required=true, placeholder='Enter last name')

            .mb-3
              label.form-label(for='editDob2') Date of Birth
              input.form-control(type='date', id='editDob2', name='dob', placeholder='MM/DD/YYYY')

            .mb-3
              label.form-label(for='editSsn2') Social Security Number (SSN)
              input.form-control(type='text', id='editSsn2', name='ssn', placeholder='123-45-6789')

            .mb-3
              label.form-label(for='editTaxFilingStatus2') Tax Filing Status
              select.form-select(id='editTaxFilingStatus2', name='taxFilingStatus')
                option(value='') Select Tax Filing Status
                option(value='Married Filing Jointly') Married Filing Jointly
                option(value='Married Filing Separately') Married Filing Separately
                option(value='Single') Single
                option(value='Head of Household') Head of Household
                option(value='Qualifying Widower') Qualifying Widower

            .mb-3
              label.form-label(for='editMaritalStatus2') Marital Status
              select.form-select(id='editMaritalStatus2', name='maritalStatus')
                option(value='') Select Marital Status
                option(value='Married') Married
                option(value='Single') Single
                option(value='Widowed') Widowed
                option(value='Divorced') Divorced

            .mb-3
              label.form-label(for='editMobileNumber2') Mobile Number
              input.form-control(type='tel', id='editMobileNumber2', name='mobileNumber', placeholder='123-456-7890')

            .mb-3
              label.form-label(for='editHomePhone2') Home Phone
              input.form-control(type='tel', id='editHomePhone2', name='homePhone', placeholder='123-456-7890')

            .mb-3
              label.form-label(for='editEmail2') Email
              input.form-control(type='email', id='editEmail2', name='email', placeholder='example@domain.com')

            .mb-3
              label.form-label(for='editHomeAddress2') Home Address
              input.form-control(type='text', id='editHomeAddress2', name='homeAddress', placeholder='Enter home address')

            .h6.mb-3.formModalHeadersTwo Additional Household Members
            button.btn.btn-secondary#edit-add-household-member(type='button') Add Household Member
            .household-members-section.mt-4

            .mb-3
              label.form-label(for='editMarginalTaxBracket') Marginal Tax Bracket (%)
              input.form-control(
                type='number', id='editMarginalTaxBracket',
                name='marginalTaxBracket', min='0', max='100', step='0.01',
                placeholder='e.g. 24'
              )

        div.modal-footer
          button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Cancel
          button.btn.btn-primary(type='submit', form='edit-household-form') Save Changes

  // -- editClientModal with consistent Bootstrap UI
  div#editClientModal.modal.fade(tabindex='-1' aria-labelledby='editClientModalLabel' aria-hidden='true')
    div.modal-dialog.modal-lg.modal-dialog-scrollable
      div.modal-content
        // Keep your existing header
        div.modal-header
          h5.modal-title#editClientModalLabel Client Info
          button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')

        // Main body
        div.modal-body
          form#editClientForm(method='POST' action='#' enctype='multipart/form-data')
            input(type='hidden' name='clientId' id='editClientId')


            .row
              .preview-image-container.col-md-4.text-center
                // Photo Preview
                img#editProfilePhotoPreview(
                  src='/images/defaultProfilePhoto.png',
                  alt='Current Profile Photo',
                  style='width: 150px; height: 150px; object-fit: cover; display: block; margin: 0 auto 0.5rem; border-radius: 50%;'
                )

                // Hidden file input
                input.form-control#editProfilePhoto(type='file' name='profilePhoto' accept='image/*', style='display: none;')

                .imagebuttons
                  // "UPLOAD IMAGE" button
                  button.btn.btn-primary#uploadImageBtn(type='button')
                    i.fas.fa-camera.me-1
                    | Upload Image

                  // "REMOVE IMAGE" button
                  button.btn.btn-outline-danger#removeImageBtn(type='button', style='margin-left: 0.5rem;') Remove

              // RIGHT COLUMN: Form fields
              .col-md-8.editClientFormContainer
                // We can place them in rows of two fields each, for a tidy layout:
                .row.mb-3
                  .col-md-6
                    label.form-label(for='editFirstName') First Name *
                    input.form-control#editFirstName(type='text' name='firstName' required)
                  .col-md-6
                    label.form-label(for='editLastName') Last Name *
                    input.form-control#editLastName(type='text' name='lastName' required)

                .row.mb-3
                  .col-md-6
                    label.form-label(for='editDob') Birthday
                    input.form-control#editDob(type='date' name='dob')
                  .col-md-6
                    label.form-label(for='editDeceasedLiving') Status
                    select.form-select#editDeceasedLiving(name='deceasedLiving')
                      option(value='Living') Living
                      option(value='Deceased') Deceased

                .row.mb-3
                  .col-md-6
                    label.form-label(for='editEmail') Email
                    input.form-control#editEmail(type='email' name='email')
                  .col-md-6
                    label.form-label(for='editPhoneNumber') Phone
                    input.form-control#editPhoneNumber(type='text' name='phoneNumber')

                .row.mb-3
                  .col-md-6
                    label.form-label(for='editMonthlyIncome') Monthly Income
                    input.form-control#editMonthlyIncome(type='number' step='0.01' name='monthlyIncome')
                .row.deleteClientRow
                  .col-12
                    button.btn.btn-danger#deleteClientBtn(type='button') Delete Client

        // Keep your existing footer
        div.modal-footer
          button.btn.btn-secondary#cancelEditBtn(type='button', data-bs-dismiss='modal') Cancel
          button.btn.btn-primary#saveClientBtn(type='submit', form='editClientForm') Save Changes


          
  // Add Account Modal
  // — ADD ACCOUNT MODAL —  (replace the whole previous block)
  div#addAccountModal.modal.fade(tabindex='-1' aria-labelledby='addAccountModalLabel' aria-hidden='true')
    div.modal-dialog.modal-lg.modal-dialog-scrollable
      div.modal-content
        div.modal-header
          h5.modal-title#addAccountModalLabel Add Account
          button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')
        div.modal-body
          form#add-account-form
            // — SECTION 1 ‑ ACCOUNT INFORMATION —
            .section-block
              h6.section-title Account Information
              .row.g-3
                .col-md-6
                  label.form-label(for='accountOwner') Account Owner
                  select.form-select#accountOwner(name='accountOwner' required)
                    option(value='') Select Account Owner
                    each client in clients
                      option(value=client._id)= `${client.firstName} ${client.lastName}`
                    option(value='joint') Joint
                .col-md-6
                  label.form-label(for='accountNumber') Account Number
                  input.form-control#accountNumber(type='text', name='accountNumber', required)
              .row.g-3.mt-0
                .col-md-6
                  label.form-label(for='accountValue') Account Value
                  input.form-control#accountValue(type='number', step='0.01', name='accountValue', required)
                .col-md-6
                  label.form-label(for='asOfDate') As Of Date
                 
                  input.form-control#asOfDate(type='date', name='asOfDate')
                .col-md-6
                  label.form-label(for='accountType') Account Type
                  select.form-select#accountType(name='accountType')
                    option(value='') Select Account Type
                    each type in accountTypes
                      option(value=type)= type
            // — SECTION 2 ‑ FINANCIAL DETAILS —
            .section-block
              h6.section-title Asset Allocation
              .row.g-3.padding-bottom-24px
                .col-md-6
                  label.form-label(for='cash') Cash %
                  input.form-control#cash(type='number', step='0.01', name='cash')
                .col-md-6
                  label.form-label(for='income') Income %
                  input.form-control#income(type='number', step='0.01', name='income')
                .col-md-6
                  label.form-label(for='annuities') Annuities %
                  input.form-control#annuities(type='number', step='0.01', name='annuities')
                .col-md-6
                  label.form-label(for='growth') Growth %
                  input.form-control#growth(type='number', step='0.01', name='growth')
              h6.section-title Systematic Withdrawals
              .systematic-withdrawals-container.mt-2
                .withdrawal-entry
                  .row.mb-2
                    .col-md-6
                      label.form-label(for='swa_0') Withdrawal Amount
                      input.form-control(type='number', step='0.01', min='0', id='swa_0', name='systematicWithdrawals[0][amount]')
                    .col-md-6
                      label.form-label(for='swf_0') Frequency
                      select.form-select(id='swf_0', name='systematicWithdrawals[0][frequency]')
                        option Monthly
                        option Quarterly
                        option Semi-annual
                        option Annually
                button.btn.btn-outline-primary.btn-sm.mt-2#add-withdrawal(type='button')
                  i.fas.fa-plus.me-1
                  | Add Another Withdrawal
            // — SECTION 3 ‑ TAX INFORMATION —
            .section-block
              h6.section-title Tax Information
              .row.g-3
                .col-md-6
                  label.form-label(for='federalTaxWithholding') Federal Tax Withholding (%)
                  input.form-control#federalTaxWithholding(type='number', step='0.01', name='federalTaxWithholding')
                .col-md-6
                  label.form-label(for='stateTaxWithholding') State Tax Withholding (%)
                  input.form-control#stateTaxWithholding(type='number', step='0.01', name='stateTaxWithholding')
              .row.g-3.mt-0
                .col-md-6
                  label.form-label(for='taxStatus') Tax Status
                  select.form-select#taxStatus(name='taxStatus')
                    option(value='') Select Tax Status
                    option(value='Taxable') Taxable
                    option(value='Tax-Free') Tax‑Free
                    option(value='Tax-Deferred') Tax‑Deferred
                .col-md-6
                  label.form-label(for='valueAsOf12_31') 12/31 Value
                  input.form-control#valueAsOf12_31(type='number', step='0.01', name='valueAsOf12_31')
            // — SECTION 4 ‑ CUSTODIAN & BENEFICIARIES —
            .section-block
              h6.section-title Custodian & Beneficiaries
              label.form-label(for='custodian') Custodian
              select.form-select#custodian(name='custodian')
                option(value='') Select Custodian
                each custodian in custodians
                  option(value=custodian)= custodian
              h6.section-subtitle Primary Beneficiaries
              .primary-beneficiaries-section
              button.btn.btn-outline-primary.btn-sm#add-primary-beneficiary(type='button') Add Primary Beneficiary
              h6.section-subtitle Contingent Beneficiaries
              .contingent-beneficiaries-section
              button.btn.btn-outline-primary.btn-sm#add-contingent-beneficiary(type='button') Add Contingent Beneficiary
              // Keep the hidden inherited / IRA sections exactly as‑is
              div#inherited-details-section(style='display:none')
              div#ira-details-section(style='display:none')
        div.modal-footer.justify-content-end
          button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Cancel
          button.btn.btn-primary(type='submit', form='add-account-form') Save Account

  
  // Edit Account Modal
  // — EDIT ACCOUNT MODAL —  (replace the whole previous block)
  div#editAccountModal.modal.fade(tabindex='-1' aria-labelledby='editAccountModalLabel' aria-hidden='true')
    div.modal-dialog.modal-lg.modal-dialog-scrollable
      div.modal-content
        div.modal-header
          h5.modal-title#editAccountModalLabel Edit Account
          button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')

        div.modal-body
          form#edit-account-form

            input(type='hidden' id='editAccountId' name='accountId')


            .section-block
              h6.section-title Account Information
              .row.g-3
                .col-md-6
                  label.form-label(for='editAccountOwner') Account Owner
                  select.form-select#editAccountOwner(name='accountOwner' required)
                    option(value='') Select Account Owner
                    each client in clients
                      option(value=client._id)= `${client.firstName} ${client.lastName}`
                    option(value='joint') Joint
                .col-md-6
                  label.form-label(for='editAccountNumber') Account Number
                  input.form-control#editAccountNumber(type='text', name='accountNumber', required)
              .row.g-3.mt-0
                .col-md-6
                  label.form-label(for='editAccountValue') Account Value
                  input.form-control#editAccountValue(type='number', step='0.01', name='accountValue', required)
                .col-md-6
                  label.form-label(for='editAsOfDate') As Of Date
                  input.form-control#editAsOfDate(type='date', name='asOfDate')
                .col-md-6
                  label.form-label(for='editAccountType') Account Type
                  select.form-select#editAccountType(name='accountType')
                    option(value='') Select Account Type
                    each type in accountTypes
                      option(value=type)= type


            .section-block
              h6.section-title Asset Allocation
              .row.g-3.padding-bottom-24px
                .col-md-6
                  label.form-label(for='editCash') Cash %
                  input.form-control#editCash(type='number', step='0.01', name='cash')
                .col-md-6
                  label.form-label(for='editIncome') Income %
                  input.form-control#editIncome(type='number', step='0.01', name='income')
                .col-md-6
                  label.form-label(for='editAnnuities') Annuities %
                  input.form-control#editAnnuities(type='number', step='0.01', name='annuities')
                .col-md-6
                  label.form-label(for='editGrowth') Growth %
                  input.form-control#editGrowth(type='number', step='0.01', name='growth')

              h6.section-title Systematic Withdrawals
              .edit-systematic-withdrawals-container.mt-2
                // rows are injected dynamically by JS
              button.btn.btn-outline-primary.btn-sm.mt-2#edit-add-withdrawal(type='button')
                i.fas.fa-plus.me-1
                | Add Another Withdrawal

            .section-block
              h6.section-title Tax Information
              .row.g-3
                .col-md-6
                  label.form-label(for='editFederalTaxWithholding') Federal Tax Withholding (%)
                  input.form-control#editFederalTaxWithholding(type='number', step='0.01', name='federalTaxWithholding')
                .col-md-6
                  label.form-label(for='editStateTaxWithholding') State Tax Withholding (%)
                  input.form-control#editStateTaxWithholding(type='number', step='0.01', name='stateTaxWithholding')
              .row.g-3.mt-0
                .col-md-6
                  label.form-label(for='editTaxStatus') Tax Status
                  select.form-select#editTaxStatus(name='taxStatus')
                    option(value='') Select Tax Status
                    option(value='Taxable') Taxable
                    option(value='Tax-Free') Tax‑Free
                    option(value='Tax-Deferred') Tax‑Deferred
                .col-md-6
                  label.form-label(for='editValueAsOf12_31') 12/31 Value
                  input.form-control#editValueAsOf12_31(type='number', step='0.01', name='valueAsOf12_31')


            .section-block
              h6.section-title Custodian & Beneficiaries
              label.form-label(for='editCustodian') Custodian
              select.form-select#editCustodian(name='custodian')
                option(value='') Select Custodian
                each custodian in custodians
                  option(value=custodian)= custodian

              h6.section-subtitle Primary Beneficiaries
              .primary-beneficiaries-section
              button.btn.btn-outline-primary.btn-sm#add-primary-beneficiary(type='button') Add Primary Beneficiary

              h6.section-subtitle Contingent Beneficiaries
              .contingent-beneficiaries-section
              button.btn.btn-outline-primary.btn-sm#add-contingent-beneficiary(type='button') Add Contingent Beneficiary

              // — Hidden detail panels (left intact for JS) —
              div#inherited-details-section(style='display:none')
                h6 Inherited Account Details
                .mb-3
                  label.form-label(for='editDeceasedName') Deceased Name
                  input.form-control#editDeceasedName(type='text', name='inheritedAccountDetails.deceasedName')
                .mb-3
                  label.form-label(for='editDateOfDeath') Date of Death
                  input.form-control#editDateOfDeath(type='date', name='inheritedAccountDetails.dateOfDeath')
                .mb-3
                  label.form-label(for='editRelationshipToDeceased') Relationship to Deceased
                  select.form-select#editRelationshipToDeceased(name='inheritedAccountDetails.relationshipToDeceased')
                    option(value='') Select Relationship
                    option(value='Spouse') Spouse
                    option(value='Non-Spouse') Non‑Spouse
                    option(value='Minor Child') Minor Child
                    option(value='Disabled Child') Disabled Child
                    option(value='Chronically Ill Individual') Chronically Ill Individual
                    option(value='Other') Other

              div#ira-details-section(style='display:none')
                h6 IRA Account Details
                .ira-conversions-section
                button.btn.btn-outline-primary.btn-sm#add-ira-conversion(type='button') Add Roth Conversion

        div.modal-footer.justify-content-end
          button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Cancel
          button.btn.btn-primary(type='submit', form='edit-account-form') Update Account



  // — ASSET MODALS —
  
  // View Asset
  div#viewAssetModal.modal.fade(tabindex='-1', aria-hidden='true')
    .modal-dialog.modal-lg
      .modal-content
        .modal-header
          h5.modal-title View Asset
          button.btn-close(data-bs-dismiss='modal')
        .modal-body
          #view-asset-content
        .modal-footer
          button.btn.btn-secondary(data-bs-dismiss='modal') Close
  
  // Add/Edit Asset (they’re identical form fields; we’ll reuse the same markup)
  div#addAssetModal.modal.fade(tabindex='-1', aria-hidden='true')
    .modal-dialog.modal-lg
      .modal-content
        .modal-header
          h5.modal-title Add Asset
          button.btn-close(data-bs-dismiss='modal')
        .modal-body
          form#add-asset-form
            input(type='hidden', id='assetId')
            .mb-3
              label.form-label(for='assetOwner') Owner *
              select.form-select#assetOwner(name='owner', required)
                option(value='') Select Owner
                each c in clients
                  option(value=c._id) #{c.firstName} #{c.lastName}
                if clients.length > 1
                  option(value='joint') Joint
            .mb-3
              label.form-label(for='assetType') Asset Type *
              input.form-control#assetType(name='assetType', required)
            .mb-3
              label.form-label(for='assetNumber') Asset Number *
              input.form-control#assetNumber(name='assetNumber', required)
            .mb-3
              label.form-label(for='assetValue') Asset Value *
              input.form-control#assetValue(type='number', step='0.01', name='assetValue', required)
        .modal-footer
          button.btn.btn-secondary(data-bs-dismiss='modal') Cancel
          button.btn.btn-primary(type='submit', form='add-asset-form') Save
  
  // Clone for Edit
  div#editAssetModal.modal.fade(tabindex='-1', aria-hidden='true')
    .modal-dialog.modal-lg
      .modal-content
        .modal-header
          h5.modal-title Edit Asset
          button.btn-close(data-bs-dismiss='modal')
        .modal-body
          form#edit-asset-form
            input(type='hidden', id='editAssetId', name='assetId')
            //— same fields as above, with IDs prefixed edit—
            .mb-3
              label.form-label(for='editAssetOwner') Owner *
              select.form-select#editAssetOwner(name='owner', required)
                option(value='') Select Owner
                each c in clients
                  option(value=c._id) #{c.firstName} #{c.lastName}
                if clients.length > 1
                  option(value='joint') Joint
            .mb-3
              label.form-label(for='editAssetType') Asset Type *
              input.form-control#editAssetType(name='assetType', required)
            .mb-3
              label.form-label(for='editAssetNumber') Asset Number *
              input.form-control#editAssetNumber(name='assetNumber', required)
            .mb-3
              label.form-label(for='editAssetValue') Asset Value *
              input.form-control#editAssetValue(type='number', step='0.01', name='assetValue', required)
        .modal-footer
          button.btn.btn-secondary(data-bs-dismiss='modal') Cancel
          button.btn.btn-primary(type='submit', form='edit-asset-form') Save
  
  // — LIABILITY MODALS —
  
  // View Liability
  div#viewLiabilityModal.modal.fade(tabindex='-1', aria-hidden='true')
    .modal-dialog.modal-lg
      .modal-content
        .modal-header
          h5.modal-title View Liability
          button.btn-close(data-bs-dismiss='modal')
        .modal-body
          #view-liability-content
        .modal-footer
          button.btn.btn-secondary(data-bs-dismiss='modal') Close
  
  // Add Liability
  div#addLiabilityModal.modal.fade(tabindex='-1', aria-hidden='true')
    .modal-dialog.modal-lg
      .modal-content
        .modal-header
          h5.modal-title Add Liability
          button.btn-close(data-bs-dismiss='modal')
        .modal-body
          form#add-liability-form
            input(type='hidden', id='liabilityId')
            .mb-3
              label.form-label(for='liabilityOwner') Owner *
              select.form-select#liabilityOwner(name='owner', required)
                option(value='') Select Owner
                each c in clients
                  option(value=c._id) #{c.firstName} #{c.lastName}
                if clients.length > 1
                  option(value='joint') Joint
            .mb-3
              label.form-label(for='liabilityType') Liability Type *
              select.form-select#liabilityType(name='liabilityType', required)
                option(value='') Select Type
                each t in ['Vehicle Loan','Home Loan','Personal Loan', 'Business Loan', 'Other']
                  option(value=t) #{t}
            .mb-3
              label.form-label(for='creditorName') Creditor Name 
              input.form-control#creditorName(name='creditorName')
            .mb-3
              label.form-label(for='accountLoanNumber') Loan Number *
              input.form-control#accountLoanNumber(name='accountLoanNumber', required)
            .mb-3
              label.form-label(for='outstandingBalance') Outstanding Balance
              input.form-control#outstandingBalance(type='number', step='0.01', name='outstandingBalance')
            .mb-3
              label.form-label(for='interestRate') Interest Rate %
              input.form-control#interestRate(type='number', step='0.01', name='interestRate')
            .mb-3
              label.form-label(for='monthlyPayment') Monthly Payment
              input.form-control#monthlyPayment(type='number', step='0.01', name='monthlyPayment')
            .mb-3
              label.form-label(for='estimatedPayoffDate') Estimated Payoff Date
              input.form-control#estimatedPayoffDate(type='date', name='estimatedPayoffDate')
        .modal-footer
          button.btn.btn-secondary(data-bs-dismiss='modal') Cancel
          button.btn.btn-primary(type='submit', form='add-liability-form') Save

  // –– Account History Modal ––
  div#accountHistoryModal.modal.fade(tabindex='-1' aria-labelledby='accountHistoryModalLabel' aria-hidden='true')
    div.modal-dialog.modal-lg.modal-dialog-scrollable
      div.modal-content
        div.modal-header
          h5#accountHistoryModalLabel.modal-title Account History
          button.btn-close(type='button' data-bs-dismiss='modal' aria-label='Close')
        div.modal-body
          //–– Header area (account meta will be injected here)
          div#history-header.border-bottom.pb-3.mb-4

          //–– Timeline container
          div#history-timeline
            // JS will inject history cards here
        div.modal-footer
          button.btn.btn-secondary(type='button' data-bs-dismiss='modal') Close


  
  // Edit Liability
  // — EDIT LIABILITY MODAL —
  div#editLiabilityModal.modal.fade(tabindex='-1', aria-labelledby='editLiabilityModalLabel', aria-hidden='true')
    .modal-dialog.modal-lg
      .modal-content
        .modal-header
          h5.modal-title#editLiabilityModalLabel Edit Liability
          button.btn-close(type='button', data-bs-dismiss='modal', aria-label='Close')
        .modal-body
          form#edit-liability-form
            input(type='hidden', id='editLiabilityId', name='liabilityId')
  
            .mb-3
              label.form-label(for='editLiabilityOwner') Owner *
              select.form-select#editLiabilityOwner(name='owner', required)
                option(value='') Select Owner
                each c in clients
                  option(value=c._id)= `${c.firstName} ${c.lastName}`
                if clients.length > 1
                  option(value='joint') Joint
  
            .mb-3
              label.form-label(for='editLiabilityType') Liability Type *
              select.form-select#editLiabilityType(name='liabilityType', required)
                option(value='') Select Type
                each t in ['Vehicle Loan','Home Loan','Personal Loan','Business Loan','Other']
                  option(value=t)= t
  
            .mb-3
              label.form-label(for='editCreditorName') Creditor Name
              input.form-control#editCreditorName(type='text', name='creditorName')
  
            .mb-3
              label.form-label(for='editAccountLoanNumber') Loan Number *
              input.form-control#editAccountLoanNumber(type='text', name='accountLoanNumber', required)
  
            .mb-3
              label.form-label(for='editOutstandingBalance') Outstanding Balance
              input.form-control#editOutstandingBalance(type='number', step='0.01', name='outstandingBalance')
  
            .mb-3
              label.form-label(for='editInterestRate') Interest Rate %
              input.form-control#editInterestRate(type='number', step='0.01', name='interestRate')
  
            .mb-3
              label.form-label(for='editMonthlyPayment') Monthly Payment
              input.form-control#editMonthlyPayment(type='number', step='0.01', name='monthlyPayment')
  
            .mb-3
              label.form-label(for='editEstimatedPayoffDate') Estimated Payoff Date
              input.form-control#editEstimatedPayoffDate(type='date', name='estimatedPayoffDate')
        .modal-footer
          button.btn.btn-secondary(type='button', data-bs-dismiss='modal') Cancel
          button.btn.btn-primary(type='submit', form='edit-liability-form') Save
  
  




block scripts
  - var safeClients = clients || [];
  - var clientsJSON = JSON.stringify(safeClients).replace(/</g, '\\u003c');
  script.
    const householdData = !{JSON.stringify(household || {}).replace(/</g, '\\u003c')};
    const clientsData = !{clientsJSON};
    const accountTypes = [
      'Individual',
      'Joint Tenants',
      'Joint',
      'Tenants in Common',
      'Community Property',
      'TOD',
      'Transfer on Death',
      'Custodial',
      'UTMA',
      'UGMA',
      'Corporate Account',
      'Partnership Account',
      'LLC Account',
      'Sole Proprietorship',
      'IRA',
      'Roth IRA',
      'Inherited IRA',
      'SEP IRA',
      'Simple IRA',
      '401(k)',
      'Solo 401(k)',
      '403(b)',
      '457(b)',
      'Pension Plan',
      'Profit Sharing Plan',
      'Keogh Plan',
      'Rollover IRA',
      'Beneficiary IRA',
      '529 Plan',
      'Coverdell ESA',
      'Trust',
      'Revocable Trust',
      'Irrevocable Trust',
      'Testamentary Trust',
      'Charitable Remainder Trust',
      'Estate',
      'Conservatorship',
      'Guardianship',
      'Annuity',
      'Variable Annuity',
      'Fixed Annuity',
      'Deferred Annuity',
      'Immediate Annuity',
      'Equity-Indexed Annuity',
      'Registered Index-Linked Annuity (RILA)',
      'Checking Account',
      'Savings Account',
      'Money Market Account',
      'Certificate of Deposit (CD)',
      'Health Savings Account (HSA)',
      'Flexible Spending Account (FSA)',
      'Donor-Advised Fund',
      'Charitable Lead Trust',
      'Municipal Account',
      'Endowment',
      'Foundation',
      'Other',
    ];
    const custodians = [
      'Fidelity',
      'Charles Schwab',
      'TD Ameritrade',
      'Vanguard',
      'Morgan Stanley',
      'Merrill Lynch',
      'Pershing',
      'Raymond James',
      'Wells Fargo',
      'LPL Financial',
      'Apex Clearing',
      'Altruist',
      'SEI Private Trust',
      'Equity Trust',
      'Kingdom Trust',
      'Pacific Premier Trust',
      'Millennium Trust',
      'U.S. Bank',
      'First Clearing',
      'Interactive Brokers',
      'DriveWealth',
      'TradeStation',
      'Robinhood',
      'SS&C Advent',
      'Empower Retirement',
      'Ascensus',
      'T. Rowe Price',
      'Transamerica',
      'John Hancock',
      'Voya',
      'Newport Trust',
      'GoldStar Trust',
      'Reliance Trust',
      'Coinbase Custody',
      'Gemini Trust',
      'Anchorage Digital',
      'BitGo Trust',
      'Bakkt',
      'Other'
    ]


  script.
    window.householdData = householdData;

    document.addEventListener('DOMContentLoaded', () => {
      const householdIdEl = document.getElementById('household-id');
      if (!householdIdEl) return;

      const householdId = householdIdEl.value;
      const tabButtons = document.querySelectorAll('.tab-link');

      tabButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const route = btn.getAttribute('data-route'); // 'client-info' / 'accounts' / 'value-adds'
          window.location.href = `/households/${householdId}/${route}`;
        });
      });
    });






  script(src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js')
  script(src='/js/appScript.js')
  script(src='/socket.io/socket.io.js') 
  script(type="module" src='/js/householdDetails.js')
  script(src='/js/householdSummary.js')
  script(src="https://cdn.jsdelivr.net/npm/chart.js")

  script(src="/js/loading.js")
  script(src="/js/calculateAge.js")
  script(src="/js/editClient.js")
  script(src="/js/valueAddCheck.js")
  script(src="/js/householdAssetsLiabilities.js")
  script(src='/js/savedValueAddsLoader.js')





